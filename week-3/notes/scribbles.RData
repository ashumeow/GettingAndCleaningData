> ## Subsetting and Sorting
> ###
> ## subsetting
> set.seed(13435)
> X <- data.frame("var1"=sample(1:5),"var2"=sample(6:10),"var3"=sample(11:15))
> X <- X[sample(1:5),]; X$var2[c(1,3)]=NA
> X
  var1 var2 var3
1    2   NA   15
4    1   10   11
2    3   NA   12
3    5    6   14
5    4    9   13
> ##
> X[,1]
[1] 2 1 3 5 4
> X[,"var1"]
[1] 2 1 3 5 4
> X[1:2,"var2"]
[1] NA 10
> ## logical AND ... logical OR
> X[(X$var1 <= 3 & X$var3 > 11),]
  var1 var2 var3
1    2   NA   15
2    3   NA   12
> X[(X$var1 <= 3 | X$var3 > 15),]
  var1 var2 var3
1    2   NA   15
4    1   10   11
2    3   NA   12
> ## dealing with missing values
> X[which(X$var2 > 8),]
  var1 var2 var3
4    1   10   11
5    4    9   13
> ##
> ## Sorting
> sort(X$var1)
[1] 1 2 3 4 5
> sort(X$var1,decreasing=TRUE)
[1] 5 4 3 2 1
> sort(X$var2,na.last=TRUE)
[1]  6  9 10 NA NA
> ## ordering
> X[order(X$var1),]
  var1 var2 var3
4    1   10   11
1    2   NA   15
2    3   NA   12
5    4    9   13
3    5    6   14
> X[order(X$var1,X$var3),]
  var1 var2 var3
4    1   10   11
1    2   NA   15
2    3   NA   12
5    4    9   13
3    5    6   14
> ## ordering with plyr
> install.packages("plyr")
--- Please select a CRAN mirror for use in this session ---
trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/plyr_1.8.2.zip'
Content type 'application/zip' length 1130763 bytes (1.1 MB)
opened URL
downloaded 1.1 MB

package ‘plyr’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
        C:\Users\dell\AppData\Local\Temp\Rtmp6FfjJK\downloaded_packages
> library(plyr)
> arrange(X,var1)
  var1 var2 var3
1    1   10   11
2    2   NA   15
3    3   NA   12
4    4    9   13
5    5    6   14
> arrange(X,desc(var1))
  var1 var2 var3
1    5    6   14
2    4    9   13
3    3   NA   12
4    2   NA   15
5    1   10   11
> ## adding rows and columns
> X$var4 <- rnorm(5)
> X
  var1 var2 var3       var4
1    2   NA   15  0.1875960
4    1   10   11  1.7869764
2    3   NA   12  0.4966936
3    5    6   14  0.0631830
5    4    9   13 -0.5361329
> Y <- cbind(X,rnorm(5))
> Y
  var1 var2 var3       var4    rnorm(5)
1    2   NA   15  0.1875960  0.62578490
4    1   10   11  1.7869764 -2.45083750
2    3   NA   12  0.4966936  0.08909424
3    5    6   14  0.0631830  0.47838570
5    4    9   13 -0.5361329  1.00053336


> ##################
> ## Summarizing data
> meowUrl <- "https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD"
> download.file(meowUrl,destfile="./get-data/restaurant.csv")
trying URL 'https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD'
Content type 'text/csv; charset=utf-8' length 112114 bytes (109 KB)
opened URL
downloaded 109 KB

> restData <- read.csv("./get-data/restaurant.csv")
> head(restData,n=3)
   name zipCode neighborhood
1   410   21206    Frankford
2  1919   21231  Fells Point
3 SAUTE   21224       Canton
  councilDistrict policeDistrict
1               2   NORTHEASTERN
2               1   SOUTHEASTERN
3               1   SOUTHEASTERN
                         Location.1
1 4509 BELAIR ROAD\nBaltimore, MD\n
2    1919 FLEET ST\nBaltimore, MD\n
3   2844 HUDSON ST\nBaltimore, MD\n
> tail(restData,n=3)
             name zipCode
1325 ZINK'S CAFÂ   21213
1326 ZISSIMOS BAR   21211
1327       ZORBAS   21224
      neighborhood councilDistrict
1325 Belair-Edison              13
1326       Hampden               7
1327     Greektown               2
     policeDistrict
1325   NORTHEASTERN
1326       NORTHERN
1327   SOUTHEASTERN
                             Location.1
1325 3300 LAWNVIEW AVE\nBaltimore, MD\n
1326      1023 36TH ST\nBaltimore, MD\n
1327  4710 EASTERN Ave\nBaltimore, MD\n
> summary(restData)
                           name     
 MCDONALD'S                  :   8  
 POPEYES FAMOUS FRIED CHICKEN:   7  
 SUBWAY                      :   6  
 KENTUCKY FRIED CHICKEN      :   5  
 BURGER KING                 :   4  
 DUNKIN DONUTS               :   4  
 (Other)                     :1293  
    zipCode             neighborhood
 Min.   :-21226   Downtown    :128  
 1st Qu.: 21202   Fells Point : 91  
 Median : 21218   Inner Harbor: 89  
 Mean   : 21185   Canton      : 81  
 3rd Qu.: 21226   Federal Hill: 42  
 Max.   : 21287   Mount Vernon: 33  
                  (Other)     :863  
 councilDistrict 
 Min.   : 1.000  
 1st Qu.: 2.000  
 Median : 9.000  
 Mean   : 7.191  
 3rd Qu.:11.000  
 Max.   :14.000  
                 
      policeDistrict
 SOUTHEASTERN:385   
 CENTRAL     :288   
 SOUTHERN    :213   
 NORTHERN    :157   
 NORTHEASTERN: 72   
 EASTERN     : 67   
 (Other)     :145   
                          Location.1    
 1101 RUSSELL ST\nBaltimore, MD\n:   9  
 201 PRATT ST\nBaltimore, MD\n   :   8  
 2400 BOSTON ST\nBaltimore, MD\n :   8  
 300 LIGHT ST\nBaltimore, MD\n   :   5  
 300 CHARLES ST\nBaltimore, MD\n :   4  
 301 LIGHT ST\nBaltimore, MD\n   :   4  
 (Other)                         :1289  
> str(restData)
'data.frame': 1327 obs. of  6 variables:
 $ name           : Factor w/ 1277 levels "#1 CHINESE KITCHEN",..: 9 3 992 1 2 4 5 6 7 8 ...
 $ zipCode        : int  21206 21231 21224 21211 21223 21218 21205 21211 21205 21231 ...
 $ neighborhood   : Factor w/ 173 levels "Abell","Arlington",..: 53 52 18 66 104 33 98 133 98 157 ...
 $ councilDistrict: int  2 1 1 14 9 14 13 7 13 1 ...
 $ policeDistrict : Factor w/ 9 levels "CENTRAL","EASTERN",..: 3 6 6 4 8 3 6 4 6 6 ...
 $ Location.1     : Factor w/ 1210 levels "1 BIDDLE ST\nBaltimore, MD\n",..: 835 334 554 755 492 537 505 530 507 569 ...
> ##
> quantile(restData$councilDistrict,na.rm=TRUE)
  0%  25%  50%  75% 100% 
   1    2    9   11   14 
> quantile(restData$councilDistrict,probs=c(0.5,0.75,0.9))
50% 75% 90% 
  9  11  12 
> table(restData$zipCode,useNA="ifany")

-21226  21201  21202  21205  21206 
     1    136    201     27     30 
 21207  21208  21209  21210  21211 
     4      1      8     23     41 
 21212  21213  21214  21215  21216 
    28     31     17     54     10 
 21217  21218  21220  21222  21223 
    32     69      1      7     56 
 21224  21225  21226  21227  21229 
   199     19     18      4     13 
 21230  21231  21234  21237  21239 
   156    127      7      1      3 
 21251  21287 
     2      1 
> ##
> sum(is.na(restData$councilDistrict))
[1] 0
> any(is.na(restData$councilDistrict))
[1] FALSE
> all(restData$zipCode > 0)
[1] FALSE
> ###
> colSums(is.na(restData))
           name         zipCode 
              0               0 
   neighborhood councilDistrict 
              0               0 
 policeDistrict      Location.1 
              0               0 
> all(colSums(is.na(restData))==0)
[1] TRUE
> table(restData$zipCode %in% c("21212"))

FALSE  TRUE 
 1299    28 
> table(restData$zipCode %in% c("21212","21213"))

FALSE  TRUE 
 1268    59 
> restData[restData$zipCode %in% c("21212","21213"),]
                                     name
29                      BAY ATLANTIC CLUB
39                            BERMUDA BAR
92                              ATWATER'S
111            BALTIMORE ESTONIAN SOCIETY
187                              CAFE ZEN
220                   CERIELLO FINE FOODS
266    CLIFTON PARK GOLF COURSE SNACK BAR
276                CLUB HOUSE BAR & GRILL
289                 CLUBHOUSE BAR & GRILL
291                           COCKY LOU'S
362       DREAM TAVERN, CARRIBEAN  U.S.A.
373                         DUNKIN DONUTS
383        EASTSIDE  SPORTS  SOCIAL  CLUB
417                      FIELDS OLD TRAIL
475                             GRAND CRU
545                           RANDY'S BAR
604     MURPHY'S NEIGHBORHOOD BAR & GRILL
616                                NEOPOL
620             NEW CLUB THUNDERBIRD INC.
626                    NEW MAYFIELD, INC.
678                          IKAN SEAFOOD
711                          KAY-CEE CLUB
763                                LA'RAE
777                  LEMONGRASS BALTIMORE
779                   LEN'S SANDWICH SHOP
845                            MCDONALD'S
852                            MCDONALD'S
873                  NEW REX LIQUORS,INC.
895                             OK TAVERN
919                          PANERA BREAD
940                    PEIWEI ASIAN DINER
949                   PERGUSA ENTERPRISES
957               PHANTOM'S BAR AND GRILL
976          POPEYES FAMOUS FRIED CHICKEN
994                         ROBBIE'S NEST
1017                          RUTLAND BAR
1018                      RYAN'S DAUGHTER
1022         saigon remembered restaurant
1053                SHIRLEY'S  HONEY HOLE
1120                     STEEPLE CHASE II
1122                               SUBWAY
1153                              TAM-TAM
1155                                TASTE
1159                         TAYLORS EAST
1186                THE EDGE BAR & LOUNGE
1187 THE EDGE BAR & LOUNGE - KITCHEN AREA
1198               THE HOLLOW BAR & GRILL
1209             THE NEW BUCKETT'S LOUNGE
1232                         THREE  ACE'S
1246                 TORAIN'S  HIDE-A-WAY
1259                    TSUNAMI BALTIMORE
1287                         VITO'S PIZZA
1298 WENDY'S OLD FASHIONED HAMBURGERS #96
1304                 WHITTEN'S  (4502-04)
1312                          wozi lounge
1319           YETI RESTAURANT & CARRYOUT
1320                     YORK CLUB TAVERN
1323            ZEN WEST ROADSIDE CANTINA
1325                         ZINK'S CAFÂ
     zipCode
29     21212
39     21213
92     21212
111    21213
187    21212
220    21212
266    21213
276    21213
289    21213
291    21213
362    21213
373    21212
383    21213
417    21212
475    21212
545    21213
604    21212
616    21212
620    21213
626    21213
678    21212
711    21212
763    21213
777    21213
779    21213
845    21213
852    21212
873    21212
895    21213
919    21212
940    21212
949    21212
957    21213
976    21212
994    21213
1017   21213
1018   21212
1022   21212
1053   21213
1120   21213
1122   21213
1153   21212
1155   21212
1159   21213
1186   21213
1187   21213
1198   21212
1209   21213
1232   21213
1246   21213
1259   21213
1287   21212
1298   21212
1304   21213
1312   21212
1319   21212
1320   21212
1323   21212
1325   21213
                    neighborhood
29                      Downtown
39                 Broadway East
92     Chinquapin Park-Belvedere
111           South Clifton Park
187                     Rosebank
220    Chinquapin Park-Belvedere
266                  Darley Park
276  Orangeville Industrial Area
289  Orangeville Industrial Area
291                Broadway East
362                Broadway East
373                     Homeland
383                Broadway East
417                   Mid-Govans
475    Chinquapin Park-Belvedere
545                Broadway East
604                   Mid-Govans
616    Chinquapin Park-Belvedere
620                  Middle East
626                Belair-Edison
678    Chinquapin Park-Belvedere
711                     Homeland
763                       Oliver
777                 Little Italy
779                Broadway East
845           South Clifton Park
852               Radnor-Winston
873                  Wilson Park
895                Biddle Street
919                  Lake Walker
940                   Cedarcroft
949                     Rosebank
957                Belair-Edison
976               Winston-Govans
994                Broadway East
1017               Broadway East
1018   Chinquapin Park-Belvedere
1022                  Mid-Govans
1053               Broadway East
1120               Biddle Street
1122                      Oliver
1153                  Mid-Govans
1155                  Mid-Govans
1159                       Berea
1186               Broadway East
1187               Broadway East
1198                    Rosebank
1209               Broadway East
1232               Belair-Edison
1246               Broadway East
1259                Little Italy
1287                  Cedarcroft
1298                    Homeland
1304           Claremont-Freedom
1312                    Guilford
1319                    Rosebank
1320                    Homeland
1323                    Rosebank
1325               Belair-Edison
     councilDistrict policeDistrict
29                11        CENTRAL
39                12        EASTERN
92                 4       NORTHERN
111               12        EASTERN
187                4       NORTHERN
220                4       NORTHERN
266               14   NORTHEASTERN
276               13        EASTERN
289               13        EASTERN
291               12        EASTERN
362               13        EASTERN
373                4       NORTHERN
383               13        EASTERN
417                4       NORTHERN
475                4       NORTHERN
545               12        EASTERN
604                4       NORTHERN
616                4       NORTHERN
620               13        EASTERN
626               13   NORTHEASTERN
678                4       NORTHERN
711                4       NORTHERN
763               12        EASTERN
777                1   SOUTHEASTERN
779               12        EASTERN
845               12        EASTERN
852                4       NORTHERN
873                4       NORTHERN
895               13        EASTERN
919                4       NORTHERN
940                4       NORTHERN
949                4       NORTHERN
957                3   NORTHEASTERN
976                4       NORTHERN
994               12        EASTERN
1017              12        EASTERN
1018               4       NORTHERN
1022               4       NORTHERN
1053              13        EASTERN
1120              13        EASTERN
1122              12        EASTERN
1153               4       NORTHERN
1155               4       NORTHERN
1159              13        EASTERN
1186              12        EASTERN
1187              12        EASTERN
1198               4       NORTHERN
1209              13        EASTERN
1232               3   NORTHEASTERN
1246              12        EASTERN
1259               1   SOUTHEASTERN
1287               4       NORTHERN
1298               4       NORTHERN
1304              13   NORTHEASTERN
1312               4       NORTHERN
1319               4       NORTHERN
1320               4       NORTHERN
1323               4       NORTHERN
1325              13   NORTHEASTERN
                               Location.1
29        206 REDWOOD ST\nBaltimore, MD\n
39        1801 NORTH AVE\nBaltimore, MD\n
92     529 BELVEDERE AVE\nBaltimore, MD\n
111       1932 BELAIR RD\nBaltimore, MD\n
187    438 BELVEDERE AVE\nBaltimore, MD\n
220    529 BELVEDERE AVE\nBaltimore, MD\n
266        2701 ST LO DR\nBaltimore, MD\n
276      4217 ERDMAN AVE\nBaltimore, MD\n
289      4217 ERDMAN AVE\nBaltimore, MD\n
291       2101 NORTH AVE\nBaltimore, MD\n
362   2300 LAFAYETTE AVE\nBaltimore, MD\n
373         5422 YORK RD\nBaltimore, MD\n
383  1203 COLLINGTON AVE\nBaltimore, MD\n
417         5723 YORK RD\nBaltimore, MD\n
475    527 BELVEDERE AVE\nBaltimore, MD\n
545       2135 NORTH AVE\nBaltimore, MD\n
604         5847 YORK RD\nBaltimore, MD\n
616    529 BELVEDERE AVE\nBaltimore, MD\n
620        2201 CHASE ST\nBaltimore, MD\n
626       3349 BELAIR RD\nBaltimore, MD\n
678    529 BELVEDERE AVE\nBaltimore, MD\n
711     201 HOMELAND AVE\nBaltimore, MD\n
763      1000 HOFFMAN ST\nBaltimore, MD\n
777     1300 BANK STREET\nBaltimore, MD\n
779   1500 WASHINGTON ST\nBaltimore, MD\n
845        2001 BROADWAY\nBaltimore, MD\n
852         5100 YORK RD\nBaltimore, MD\n
873         4637 YORK RD\nBaltimore, MD\n
895       2301 BIDDLE ST\nBaltimore, MD\n
919     6307 1 2 YORK RD\nBaltimore, MD\n
940         6302 YORK RD\nBaltimore, MD\n
949         5928 YORK RD\nBaltimore, MD\n
957       3539 BELAIR RD\nBaltimore, MD\n
976         5002 YORK RD\nBaltimore, MD\n
994       2250 NORTH AVE\nBaltimore, MD\n
1017    1508 RUTLAND AVE\nBaltimore, MD\n
1018   600 BELVEDERE AVE\nBaltimore, MD\n
1022        5857 york rd\nBaltimore, MD\n
1053      2300 OLIVER ST\nBaltimore, MD\n
1120       2401 CHASE ST\nBaltimore, MD\n
1122      1400 NORTH AVE\nBaltimore, MD\n
1153        5722 YORK RD\nBaltimore, MD\n
1155   510 BELVEDERE AVE\nBaltimore, MD\n
1159     1201 POTOMAC ST\nBaltimore, MD\n
1186     2015 FEDERAL ST\nBaltimore, MD\n
1187     2015 FEDERAL ST\nBaltimore, MD\n
1198        5921 YORK RD\nBaltimore, MD\n
1209     1432 CHESTER ST\nBaltimore, MD\n
1232      3534 belair RD\nBaltimore, MD\n
1246   1701 ELLSWORTH ST\nBaltimore, MD\n
1259        1300 BANK ST\nBaltimore, MD\n
1287        6304 YORK RD\nBaltimore, MD\n
1298        5615 YORK RD\nBaltimore, MD\n
1304     4502 ERDMAN AVE\nBaltimore, MD\n
1312        4515 YORK RD\nBaltimore, MD\n
1319        5926 YORK RD\nBaltimore, MD\n
1320        5407 YORK RD\nBaltimore, MD\n
1323        5916 YORK RD\nBaltimore, MD\n
1325   3300 LAWNVIEW AVE\nBaltimore, MD\n

> ## cross tabs
> data(UCBAdmissions)
> DF = as.data.frame(UCBAdmissions)
> summary(DF)
      Admit       Gender   Dept 
 Admitted:12   Male  :12   A:4  
 Rejected:12   Female:12   B:4  
                           C:4  
                           D:4  
                           E:4  
                           F:4  
      Freq      
 Min.   :  8.0  
 1st Qu.: 80.0  
 Median :170.0  
 Mean   :188.6  
 3rd Qu.:302.5  
 Max.   :512.0  

> xt <- xtabs(Freq ~ Gender + Admit, data = DF)
> xt
        Admit
Gender   Admitted Rejected
  Male       1198     1493
  Female      557     1278

> ## flat tables
> warpbreaks$replicate <- rep(1:9,len=54)
> xt=xtabs(breaks ~.,data=warpbreaks)
> xt
, , replicate = 1

    tension
wool  L  M  H
   A 26 18 36
   B 27 42 20

, , replicate = 2

    tension
wool  L  M  H
   A 30 21 21
   B 14 26 21

, , replicate = 3

    tension
wool  L  M  H
   A 54 29 24
   B 29 19 24

, , replicate = 4

    tension
wool  L  M  H
   A 25 17 18
   B 19 16 17

, , replicate = 5

    tension
wool  L  M  H
   A 70 12 10
   B 29 39 13

, , replicate = 6

    tension
wool  L  M  H
   A 52 18 43
   B 31 28 15

, , replicate = 7

    tension
wool  L  M  H
   A 51 35 28
   B 41 21 15

, , replicate = 8

    tension
wool  L  M  H
   A 26 30 15
   B 20 39 16

, , replicate = 9

    tension
wool  L  M  H
   A 67 36 26
   B 44 29 28

> ftable(xt)
             replicate  1  2  3  4  5  6  7  8  9
wool tension                                     
A    L                 26 30 54 25 70 52 51 26 67
     M                 18 21 29 17 12 18 35 30 36
     H                 36 21 24 18 10 43 28 15 26
B    L                 27 14 29 19 29 31 41 20 44
     M                 42 26 19 16 39 28 21 39 29
     H                 20 21 24 17 13 15 15 16 28
> ## size of a dataset
> fakeData=rnorm(1e5)
> object.size(fakeData)
800040 bytes
> print(object.size(fakeData),units="MB")
0.8 Mb


> restData <- read.csv("./get-data/restaurant.csv")
> ##creating sequences
> s1 <- seq(1,10,by=2); s1
[1] 1 3 5 7 9
> s2 <- seq(1,10,length=3); s2
[1]  1.0  5.5 10.0
> x <- c(1,3,8,25,100); seq(along=x)
[1] 1 2 3 4 5
> restData$nearMe=restData$neighborhood %in% c("Roland Park","Homeland")
> table(restData$nearMe)

FALSE  TRUE 
 1314    13 
> ## creating binary variables
> restData$zipWrong=ifelse(restData$zipCode<0,TRUE,FALSE)
> table(restData$zipWrong,restData$zipCode<0)
       
        FALSE TRUE
  FALSE  1326    0
  TRUE      0    1
> restData$zipGroups=cut(restData$zipCode,breaks=quantile(restData$zipCode))
> table(restData$zipGroups)

(-2.123e+04,2.12e+04]  (2.12e+04,2.122e+04] (2.122e+04,2.123e+04] 
                  337                   375                   282 
(2.123e+04,2.129e+04] 
                  332 
> table(restData$zipGroups,restData$zipCode)
                       
                        -21226 21201 21202 21205 21206 21207 21208 21209 21210
  (-2.123e+04,2.12e+04]      0   136   201     0     0     0     0     0     0
  (2.12e+04,2.122e+04]       0     0     0    27    30     4     1     8    23
  (2.122e+04,2.123e+04]      0     0     0     0     0     0     0     0     0
  (2.123e+04,2.129e+04]      0     0     0     0     0     0     0     0     0
                       
                        21211 21212 21213 21214 21215 21216 21217 21218 21220
  (-2.123e+04,2.12e+04]     0     0     0     0     0     0     0     0     0
  (2.12e+04,2.122e+04]     41    28    31    17    54    10    32    69     0
  (2.122e+04,2.123e+04]     0     0     0     0     0     0     0     0     1
  (2.123e+04,2.129e+04]     0     0     0     0     0     0     0     0     0
                       
                        21222 21223 21224 21225 21226 21227 21229 21230 21231
  (-2.123e+04,2.12e+04]     0     0     0     0     0     0     0     0     0
  (2.12e+04,2.122e+04]      0     0     0     0     0     0     0     0     0
  (2.122e+04,2.123e+04]     7    56   199    19     0     0     0     0     0
  (2.123e+04,2.129e+04]     0     0     0     0    18     4    13   156   127
                       
                        21234 21237 21239 21251 21287
  (-2.123e+04,2.12e+04]     0     0     0     0     0
  (2.12e+04,2.122e+04]      0     0     0     0     0
  (2.122e+04,2.123e+04]     0     0     0     0     0
  (2.123e+04,2.129e+04]     7     1     3     2     1
> ##########
> install.packages("Hmisc")
--- Please select a CRAN mirror for use in this session ---
also installing the dependencies ‘Formula’, ‘latticeExtra’, ‘acepack’, ‘gridExtra’

trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/Formula_1.2-1.zip'
Content type 'application/zip' length 163275 bytes (159 KB)
opened URL
downloaded 159 KB

trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/latticeExtra_0.6-26.zip'
Content type 'application/zip' length 2063305 bytes (2.0 MB)
opened URL
downloaded 2.0 MB

trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/acepack_1.3-3.3.zip'
Content type 'application/zip' length 69235 bytes (67 KB)
opened URL
downloaded 67 KB

trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/gridExtra_0.9.1.zip'
Content type 'application/zip' length 95732 bytes (93 KB)
opened URL
downloaded 93 KB

trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/Hmisc_3.16-0.zip'
Content type 'application/zip' length 1613621 bytes (1.5 MB)
opened URL
downloaded 1.5 MB

package ‘Formula’ successfully unpacked and MD5 sums checked
package ‘latticeExtra’ successfully unpacked and MD5 sums checked
package ‘acepack’ successfully unpacked and MD5 sums checked
package ‘gridExtra’ successfully unpacked and MD5 sums checked
package ‘Hmisc’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
        C:\Users\dell\AppData\Local\Temp\RtmpM5fY5l\downloaded_packages
> library(Hmisc)
Loading required package: grid
Loading required package: lattice
Loading required package: survival
Loading required package: Formula
Loading required package: ggplot2

Attaching package: ‘Hmisc’

The following objects are masked from ‘package:base’:

    format.pval, round.POSIXt, trunc.POSIXt, units

> restData$zipGroups=cut2(restData$zipCode,g=4)
> table(restData$zipGroups)

[-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
           338            375            300            314 
> ## creating factor variables
> restData$zcf <- factor(restData$zipCode)
> restData$zcf[1:10]
 [1] 21206 21231 21224 21211 21223 21218 21205 21211 21205 21231
32 Levels: -21226 21201 21202 21205 21206 21207 21208 21209 21210 ... 21287
> class(restData$zcf)
[1] "factor"
> ## levels of factor variables
> yesno <- sample(c("yes","no"),size=10,replace=TRUE)
> yesnofac = factor(yesno,levels=c("yes","no"))
> relevel(yesnofac,ref="yes")
 [1] yes no  yes yes no  yes yes no  no  yes
Levels: yes no
> as.numeric(yesnofac)
 [1] 1 2 1 1 2 1 1 2 2 1
> ## cutting produces factor variables
> library(Hmisc)
> restData$zipGroups=cut2(restData$zipCode,g=4)
> table(restData$zipGroups)

[-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
           338            375            300            314 
> ## using mutate function
> library(Hmisc)
> restData2=mutate(restData,zipGroups=cut2(zipCode,g=4))
Error: could not find function "mutate"
> library(plyr)

Attaching package: ‘plyr’

The following objects are masked from ‘package:Hmisc’:

    is.discrete, summarize

> restData2=mutate(restData,zipGroups=cut2(zipCode,g=4))
> table(restData2$zipGroups)

[-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
           338            375            300            314 


> ## Reshaping data
> #####
> install.packages("reshape2")
trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/reshape2_1.4.1.zip'
Content type 'application/zip' length 504528 bytes (492 KB)
opened URL
downloaded 492 KB

package ‘reshape2’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
        C:\Users\dell\AppData\Local\Temp\RtmpKQs5uO\downloaded_packages

> ############
> library(reshape2)
> head(mtcars)
                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
> ## melting data frames
> mtcars$carname <- rownames(mtcars)
> carMelt <- melt(mtcars,id=c("carname","gear","cyl"),measure.vars=c("mpg","hp"))
> head(carMelt,n=3)
        carname gear cyl variable value
1     Mazda RX4    4   6      mpg  21.0
2 Mazda RX4 Wag    4   6      mpg  21.0
3    Datsun 710    4   4      mpg  22.8
> tail(carMelt,n=3)
         carname gear cyl variable value
62  Ferrari Dino    5   6       hp   175
63 Maserati Bora    5   8       hp   335
64    Volvo 142E    4   4       hp   109
> ## casting data frames
> cylData <- dcast(carMelt,cyl ~ variable)
Aggregation function missing: defaulting to length
> cylData
  cyl mpg hp
1   4  11 11
2   6   7  7
3   8  14 14
> cylData <- dcast(carMelt,cyl ~ variable,mean)
> cylData
  cyl      mpg        hp
1   4 26.66364  82.63636
2   6 19.74286 122.28571
3   8 15.10000 209.21429
> head(InsectSprays)
  count spray
1    10     A
2     7     A
3    20     A
4    14     A
5    14     A
6    12     A

> tapply(InsectSprays$count,InsectSprays$spray,sum)
  A   B   C   D   E   F 
174 184  25  59  42 200 
> spIns = split(InsectSprays$count,InsectSprays$spray)
> spIns
$A
 [1] 10  7 20 14 14 12 10 23 17 20 14 13

$B
 [1] 11 17 21 11 16 14 17 17 19 21  7 13

$C
 [1] 0 1 7 2 3 1 2 1 3 0 1 4

$D
 [1]  3  5 12  6  4  3  5  5  5  5  2  4

$E
 [1] 3 5 3 5 3 6 1 1 3 2 6 4

$F
 [1] 11  9 15 22 15 16 13 10 26 26 24 13

> sprCount=lapply(spIns,sum)
> sprCount
$A
[1] 174

$B
[1] 184

$C
[1] 25

$D
[1] 59

$E
[1] 42

$F
[1] 200

> unlist(sprCount)
  A   B   C   D   E   F 
174 184  25  59  42 200 
> sapply(spIns,sum)
  A   B   C   D   E   F 
174 184  25  59  42 200 
> library(plyr)
> ddply(InsectSprays,.(spray),summarize,sum=sum(count))
  spray sum
1     A 174
2     B 184
3     C  25
4     D  59
5     E  42
6     F 200
> spraySums <- ddply(InsectSprays,.(spray),summarize,sum=ave(count,FUN=sum))
> dim(spraySums)
[1] 72  2
> head(spraySums)
  spray sum
1     A 174
2     A 174
3     A 174
4     A 174
5     A 174
6     A 174


> ## managing data frames with dplyr - Introduction
> ## managing data frames with dplyr
> ################################################
> ## managing data frames with dplyr
> install.packages("dplyr")
--- Please select a CRAN mirror for use in this session ---
trying URL 'http://ftp.iitm.ac.in/cran/bin/windows/contrib/3.1/dplyr_0.4.1.zip'
Content type 'application/zip' length 2602655 bytes (2.5 MB)
opened URL
downloaded 2.5 MB

package ‘dplyr’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
        C:\Users\dell\AppData\Local\Temp\RtmpmMknDq\downloaded_packages
> library(dplyr)

Attaching package: ‘dplyr’

The following object is masked from ‘package:stats’:

    filter

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> options(width=105)
> chicago <- readRDS("chicago.rds") ## download chicago.rds
> dim(chicago)
[1] 6940    8
> str(chicago)
'data.frame':   6940 obs. of  8 variables:
 $ city      : chr  "chic" "chic" "chic" "chic" ...
 $ tmpd      : num  31.5 33 33 29 32 40 34.5 29 26.5 32.5 ...
 $ dptp      : num  31.5 29.9 27.4 28.6 28.9 ...
 $ date      : Date, format: "1987-01-01" "1987-01-02" "1987-01-03" ...
 $ pm25tmean2: num  NA NA NA NA NA NA NA NA NA NA ...
 $ pm10tmean2: num  34 NA 34.2 47 NA ...
 $ o3tmean2  : num  4.25 3.3 3.33 4.38 4.75 ...
 $ no2tmean2 : num  20 23.2 23.8 30.4 30.3 ...
> names(chicago)
[1] "city"       "tmpd"       "dptp"       "date"       "pm25tmean2" "pm10tmean2" "o3tmean2"  
[8] "no2tmean2" 
> head(select(chicago,city:dptp))
  city tmpd   dptp
1 chic 31.5 31.500
2 chic 33.0 29.875
3 chic 33.0 27.375
4 chic 29.0 28.625
5 chic 32.0 28.875
6 chic 40.0 35.125
> head(select(chicago,-(city:dptp)))
        date pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
1 1987-01-01         NA   34.00000 4.250000  19.98810
2 1987-01-02         NA         NA 3.304348  23.19099
3 1987-01-03         NA   34.16667 3.333333  23.81548
4 1987-01-04         NA   47.00000 4.375000  30.43452
5 1987-01-05         NA         NA 4.750000  30.33333
6 1987-01-06         NA   48.00000 5.833333  25.77233
> i <- match("city",names(chicago))
> j <- match("dptp",names(chicago))
> head(chicago[,-(i:j)])
        date pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
1 1987-01-01         NA   34.00000 4.250000  19.98810
2 1987-01-02         NA         NA 3.304348  23.19099
3 1987-01-03         NA   34.16667 3.333333  23.81548
4 1987-01-04         NA   47.00000 4.375000  30.43452
5 1987-01-05         NA         NA 4.750000  30.33333
6 1987-01-06         NA   48.00000 5.833333  25.77233

> chic.f <- filter(chicago,pm25tmean2 > 30)
> head(chic.f,10)
   city tmpd dptp       date pm25tmean2 pm10tmean2  o3tmean2 no2tmean2
1  chic   23 21.9 1998-01-17      38.10   32.46154  3.180556  25.30000
2  chic   28 25.8 1998-01-23      33.95   38.69231  1.750000  29.37630
3  chic   55 51.3 1998-04-30      39.40   34.00000 10.786232  25.31310
4  chic   59 53.7 1998-05-01      35.40   28.50000 14.295125  31.42905
5  chic   57 52.0 1998-05-02      33.30   35.00000 20.662879  26.79861
6  chic   57 56.0 1998-05-07      32.10   34.50000 24.270422  33.99167
7  chic   75 65.8 1998-05-15      56.50   91.00000 38.573007  29.03261
8  chic   61 59.0 1998-06-09      33.80   26.00000 17.890810  25.49668
9  chic   73 60.3 1998-07-13      30.30   64.50000 37.018865  37.93056
10 chic   78 67.1 1998-07-14      41.40   75.00000 40.080902  32.59054
> chic.f <- filter(chicago,pm25tmean2 > 30 & tmpd > 80)
> head(chic.f)
  city tmpd dptp       date pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
1 chic   81 71.2 1998-08-23    39.6000       59.0 45.86364  14.32639
2 chic   81 70.4 1998-09-06    31.5000       50.5 50.66250  20.31250
3 chic   82 72.2 2001-07-20    32.3000       58.5 33.00380  33.67500
4 chic   84 72.9 2001-08-01    43.7000       81.5 45.17736  27.44239
5 chic   85 72.6 2001-08-08    38.8375       70.0 37.98047  27.62743
6 chic   84 72.6 2001-08-09    38.2000       66.0 36.73245  26.46742
> chicago <- arrange(chicago,date)
> head(chicago)
  city tmpd   dptp       date pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
1 chic 31.5 31.500 1987-01-01         NA   34.00000 4.250000  19.98810
2 chic 33.0 29.875 1987-01-02         NA         NA 3.304348  23.19099
3 chic 33.0 27.375 1987-01-03         NA   34.16667 3.333333  23.81548
4 chic 29.0 28.625 1987-01-04         NA   47.00000 4.375000  30.43452
5 chic 32.0 28.875 1987-01-05         NA         NA 4.750000  30.33333
6 chic 40.0 35.125 1987-01-06         NA   48.00000 5.833333  25.77233
> tail(chicago)
     city tmpd dptp       date pm25tmean2 pm10tmean2  o3tmean2 no2tmean2
6935 chic   35 29.6 2005-12-26    8.40000        8.5 14.041667  16.81944
6936 chic   40 33.6 2005-12-27   23.56000       27.0  4.468750  23.50000
6937 chic   37 34.5 2005-12-28   17.75000       27.5  3.260417  19.28563
6938 chic   35 29.4 2005-12-29    7.45000       23.5  6.794837  19.97222
6939 chic   36 31.0 2005-12-30   15.05714       19.2  3.034420  22.80556
6940 chic   35 30.1 2005-12-31   15.00000       23.5  2.531250  13.25000
> chicago <- arrange(chicago,desc(date))
> head(chicago)
  city tmpd dptp       date pm25tmean2 pm10tmean2  o3tmean2 no2tmean2
1 chic   35 30.1 2005-12-31   15.00000       23.5  2.531250  13.25000
2 chic   36 31.0 2005-12-30   15.05714       19.2  3.034420  22.80556
3 chic   35 29.4 2005-12-29    7.45000       23.5  6.794837  19.97222
4 chic   37 34.5 2005-12-28   17.75000       27.5  3.260417  19.28563
5 chic   40 33.6 2005-12-27   23.56000       27.0  4.468750  23.50000
6 chic   35 29.6 2005-12-26    8.40000        8.5 14.041667  16.81944
> tail(chicago)
     city tmpd   dptp       date pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
6935 chic 40.0 35.125 1987-01-06         NA   48.00000 5.833333  25.77233
6936 chic 32.0 28.875 1987-01-05         NA         NA 4.750000  30.33333
6937 chic 29.0 28.625 1987-01-04         NA   47.00000 4.375000  30.43452
6938 chic 33.0 27.375 1987-01-03         NA   34.16667 3.333333  23.81548
6939 chic 33.0 29.875 1987-01-02         NA         NA 3.304348  23.19099
6940 chic 31.5 31.500 1987-01-01         NA   34.00000 4.250000  19.98810
> ## renaming variable
> chicago <- rename(chicago,pm25=pm25tmean2,dewpoint=dptp)
> head(chicago)
  city tmpd dewpoint       date     pm25 pm10tmean2  o3tmean2 no2tmean2
1 chic   35     30.1 2005-12-31 15.00000       23.5  2.531250  13.25000
2 chic   36     31.0 2005-12-30 15.05714       19.2  3.034420  22.80556
3 chic   35     29.4 2005-12-29  7.45000       23.5  6.794837  19.97222
4 chic   37     34.5 2005-12-28 17.75000       27.5  3.260417  19.28563
5 chic   40     33.6 2005-12-27 23.56000       27.0  4.468750  23.50000
6 chic   35     29.6 2005-12-26  8.40000        8.5 14.041667  16.81944
> chicago <- mutate(chicago,pm25detrend=pm25-mean(pm25,na.rm=TRUE))
> head(select(chicago,pm25,pm25detrend))
      pm25 pm25detrend
1 15.00000   -1.230958
2 15.05714   -1.173815
3  7.45000   -8.780958
4 17.75000    1.519042
5 23.56000    7.329042
6  8.40000   -7.830958
> chicago <- mutate(chicago,tempcat=factor(1*(tmpd>80),labels=c("cold","hot")))
> hotcold <- group_by(chicago,tempcat)
> hotcold
Source: local data frame [6,940 x 10]
Groups: tempcat

   city tmpd dewpoint       date     pm25 pm10tmean2  o3tmean2 no2tmean2 pm25detrend tempcat
1  chic   35     30.1 2005-12-31 15.00000       23.5  2.531250  13.25000   -1.230958    cold
2  chic   36     31.0 2005-12-30 15.05714       19.2  3.034420  22.80556   -1.173815    cold
3  chic   35     29.4 2005-12-29  7.45000       23.5  6.794837  19.97222   -8.780958    cold
4  chic   37     34.5 2005-12-28 17.75000       27.5  3.260417  19.28563    1.519042    cold
5  chic   40     33.6 2005-12-27 23.56000       27.0  4.468750  23.50000    7.329042    cold
6  chic   35     29.6 2005-12-26  8.40000        8.5 14.041667  16.81944   -7.830958    cold
7  chic   35     32.1 2005-12-25  6.70000        8.0 14.354167  13.79167   -9.530958    cold
8  chic   37     35.2 2005-12-24 30.77143       25.2  1.770833  31.98611   14.540471    cold
9  chic   41     32.6 2005-12-23 32.90000       34.5  6.906250  29.08333   16.669042    cold
10 chic   22     23.3 2005-12-22 36.65000       42.5  5.385417  33.73026   20.419042    cold
..  ...  ...      ...        ...      ...        ...       ...       ...         ...     ...
> summarize(hotcold,pm25=mean(pm25),o3=max(o3tmean2),no2=median(no2tmean2))
Source: local data frame [3 x 4]

  tempcat    pm25        o3      no2
1    cold      NA 66.587500 24.54924
2     hot      NA 62.969656 24.93870
3      NA 47.7375  9.416667 37.44444
> summarize(hotcold,pm25=mean(pm25,na.rm=TRUE),o3=max(o3tmean2),no2=median(no2tmean2))
Source: local data frame [3 x 4]

  tempcat     pm25        o3      no2
1    cold 15.97807 66.587500 24.54924
2     hot 26.48118 62.969656 24.93870
3      NA 47.73750  9.416667 37.44444
> chicago <- mutate(chicago,year=as.POSIXlt(date)$year+1900)
> years <- group_by(chicago,year)
> summarize(years,pm25=mean(pm25,na.rm=TRUE),o3=max(o3tmean2),no2=median(no2tmean2))
Source: local data frame [19 x 4]

   year     pm25       o3      no2
1  1987      NaN 62.96966 23.49369
2  1988      NaN 61.67708 24.52296
3  1989      NaN 59.72727 26.14062
4  1990      NaN 52.22917 22.59583
5  1991      NaN 63.10417 21.38194
6  1992      NaN 50.82870 24.78921
7  1993      NaN 44.30093 25.76993
8  1994      NaN 52.17844 28.47500
9  1995      NaN 66.58750 27.26042
10 1996      NaN 58.39583 26.38715
11 1997      NaN 56.54167 25.48143
12 1998 18.26467 50.66250 24.58649
13 1999 18.49646 57.48864 24.66667
14 2000 16.93806 55.76103 23.46082
15 2001 16.92632 51.81984 25.06522
16 2002 15.27335 54.88043 22.73750
17 2003 15.23183 56.16608 24.62500
18 2004 14.62864 44.48240 23.39130
19 2005 16.18556 58.84126 22.62387

> chicago %>% mutate(month=as.POSIXlt(date)$mon+1) %>% group_by(month) %>% summarize(pm25=mean(pm25,na.rm=TRUE),o3=max(o3tmean2),no2=median(no2tmean2))
Source: local data frame [12 x 4]

   month     pm25       o3      no2
1      1 17.76996 28.22222 25.35417
2      2 20.37513 37.37500 26.78034
3      3 17.40818 39.05000 26.76984
4      4 13.85879 47.94907 25.03125
5      5 14.07420 52.75000 24.22222
6      6 15.86461 66.58750 25.01140
7      7 16.57087 59.54167 22.38442
8      8 16.93380 53.96701 22.98333
9      9 15.91279 57.48864 24.47917
10    10 14.23557 47.09275 24.15217
11    11 15.15794 29.45833 23.56537
12    12 17.52221 27.70833 24.45773
